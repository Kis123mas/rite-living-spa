{% load static %}

<nav class="navbar navbar-expand px-3 border-bottom">
    <button class="btn" id="sidebar-toggle" type="button">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="navbar-collapse navbar">
        <ul class="navbar-nav">
            <li class="nav-item position-relative me-4">
                <a href="#" class="nav-link d-flex align-items-center" data-bs-toggle="modal"
                    data-bs-target="#ordersModal">
                    <i class="bi bi-bag me-1"></i>
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                        5
                        <span class="visually-hidden">unread messages</span>
                    </span>
                </a>
            </li>
            <li class="nav-item dropdown">
                <a href="#" data-bs-toggle="dropdown" class="nav-icon pe-md-0">
                    <img src="{% if request.user.profile.profile_picture %}{{ request.user.profile.profile_picture.url }}{% else %}{% static 'firstApp/images/defaultprofile.png' %}{% endif %}" class="avatar img-fluid rounded" alt="Profile Picture">
                </a>
                <div class="dropdown-menu dropdown-menu-end">
                    <a href="{% url 'profilepage' %}" class="dropdown-item">Profile</a>
                    <a href="{% url 'logout' %}" class="dropdown-item">Logout</a>
                </div>
            </li>
        </ul>
    </div>
</nav>


<div class="modal fade" id="ordersModal" tabindex="-1" aria-labelledby="ordersModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ordersModalLabel">Client Orders</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul class="list-group">

                    <!-- Order Item -->
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <img src="{% static 'firstApp/images/client1.jpg' %}" alt="Client 1"
                                class="rounded-circle me-3" style="width: 50px; height: 50px;">
                            <div>
                                <div><strong>John Doe</strong></div>
                                <div>Order #1 - iPhone 14 Pro</div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                            <a href="{% static 'firstApp/uploads/order1.pdf' %}" download title="Download File">
                                <i class="bi bi-download fs-5 text-primary"></i>
                            </a>
                            <i class="bi bi-check-circle-fill text-success fs-5" role="button" title="Approve"></i>
                            <i class="bi bi-x-circle-fill text-danger fs-5" role="button" title="Decline"></i>
                            <i class="bi bi-chat-dots-fill text-info fs-5" role="button" title="Send Message"
                                onclick="openMessageModal()"></i>
                        </div>
                    </li>

                    <!-- Order Item -->
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <img src="{% static 'firstApp/images/client2.jpg' %}" alt="Client 2"
                                class="rounded-circle me-3" style="width: 50px; height: 50px;">
                            <div>
                                <div><strong>Jane Smith</strong></div>
                                <div>Order #2 - MacBook Air</div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                            <a href="{% static 'firstApp/uploads/order2.pdf' %}" download title="Download File">
                                <i class="bi bi-download fs-5 text-primary"></i>
                            </a>
                            <i class="bi bi-check-circle-fill text-success fs-5" role="button" title="Approve"></i>
                            <i class="bi bi-x-circle-fill text-danger fs-5" role="button" title="Decline"></i>
                            <i class="bi bi-chat-dots-fill text-info fs-5" role="button" title="Send Message"
                                onclick="openMessageModal()"></i>
                        </div>
                    </li>

                    <!-- Order Item -->
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <img src="{% static 'firstApp/images/client3.jpg' %}" alt="Client 3"
                                class="rounded-circle me-3" style="width: 50px; height: 50px;">
                            <div>
                                <div><strong>Mike Johnson</strong></div>
                                <div>Order #3 - AirPods Pro</div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                            <a href="{% static 'firstApp/uploads/order3.pdf' %}" download title="Download File">
                                <i class="bi bi-download fs-5 text-primary"></i>
                            </a>
                            <i class="bi bi-check-circle-fill text-success fs-5" role="button" title="Approve"></i>
                            <i class="bi bi-x-circle-fill text-danger fs-5" role="button" title="Decline"></i>
                            <i class="bi bi-chat-dots-fill text-info fs-5" role="button" title="Send Message"
                                onclick="openMessageModal()"></i>
                        </div>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</div>




<!-- Message Modal -->
<div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="messageModalLabel">Send Message to Client</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="clientMessage" class="form-label">Your Message</label>
                        <textarea class="form-control" id="clientMessage" rows="4"
                            placeholder="Type your message..."></textarea>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Send</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>



<script>
    function openMessageModal() {
        const ordersModal = bootstrap.Modal.getInstance(document.getElementById('ordersModal'));
        ordersModal.hide();

        // Wait for the first modal to fully close before showing the next
        setTimeout(() => {
            const messageModal = new bootstrap.Modal(document.getElementById('messageModal'));
            messageModal.show();
        }, 500); // 500ms is a safe buffer for fade transition
    }
</script>