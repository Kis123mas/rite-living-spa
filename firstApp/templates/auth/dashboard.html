{% extends 'auth/maindash.html' %}
{% load static %}

{% block content %}
<div class="main">
    {% include 'auth/nav.html' %}

    
    <!-- <main class="content px-4 py-3"> -->
    <main class="content px-4 py-3" style="max-height: 90vh; overflow-y: auto;">
        <div class="mb-4">
            <h2>Dashboard</h2>
            <p class="text-muted">Manage and view your schedule in one place.</p>
        </div>

        {% if user.is_secretary or user.is_admin %}
        <div class="container-fluid py-1">  <!-- Reduced the padding even more -->
            <div class="container">
                
                <!-- Row: Service Stats -->
                <div class="row mb-2">  <!-- Reduced margin-bottom even more -->
                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title" style="font-size: 0.8rem;">üßë‚Äçüíº Service Stats by Staff</h5>  <!-- Reduced font size more -->
                        
                                <!-- Month & Year Filter -->
                                <form method="get" class="mb-1">  <!-- Reduced margin-bottom here -->
                                    <label for="month" style="font-size: 0.8rem;">Month:</label>  <!-- Reduced font size -->
                                    <select name="month" id="month" class="form-select d-inline" style="font-size: 0.8rem; height: 30px; width: 100px;">
                                        {% for i in months %}
                                            <option value="{{ forloop.counter }}" {% if forloop.counter == month %}selected{% endif %}>
                                                {{ i }}
                                            </option>
                                        {% endfor %}
                                    </select>
                        
                                    <label for="year" class="ms-1" style="font-size: 0.8rem;">Year:</label>  <!-- Reduced font size -->
                                    <select name="year" id="year" class="form-select d-inline w-auto" style="font-size: 0.8rem;">
                                        <option value="2023" {% if year == 2023 %}selected{% endif %}>2023</option>
                                        <option value="2024" {% if year == 2024 %}selected{% endif %}>2024</option>
                                        <option value="2025" {% if year == 2025 %}selected{% endif %}>2025</option>
                                    </select>
                        
                                    <button type="submit" class="btn btn-primary ms-1" style="font-size: 0.8rem;">Filter</button>  <!-- Reduced font size -->
                                </form>
                        
                                <!-- Pie Chart for Service Stats -->
                                <canvas id="staffServiceChart" height="100"></canvas>  <!-- Reduced chart height even further -->
                            </div>
                        </div>
                    </div>
                
                    <!-- Bar Chart for User Registrations -->
                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title" style="font-size: 0.8rem;">üë§ User Growth</h5>
                        
                                <!-- Bar Chart for User Registrations -->
                                <canvas id="userGrowthChart" height="150"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
        
            </div>
        </div>
        
        
        {% endif %}
    </main>

    
    
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        
<script>
    // Pie Chart for Service Stats
    const staffServiceData = {
        labels: JSON.parse('{{ staff_labels|escapejs }}'),
        datasets: [{
            label: 'Services Rendered',
            data: JSON.parse('{{ staff_data|escapejs }}'),
            backgroundColor: [
                '#007bff', '#6610f2', '#6f42c1', '#e83e8c',
                '#fd7e14', '#20c997', '#17a2b8', '#ffc107'
            ],
            borderWidth: 1
        }]
    };

    new Chart(document.getElementById('staffServiceChart').getContext('2d'), {
        type: 'pie',
        data: staffServiceData,
        options: {
            responsive: true
        }
    });

</script>
{% endblock %}
